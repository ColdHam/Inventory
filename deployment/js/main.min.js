tpl={templates:{},loadTemplates:function(c,d){var b=this;var a=function(f){var e=c[f];$.get("templates/"+e+".html",function(g){b.templates[e]=g;f++;if(f<c.length){a(f)}else{d()}})};a(0)},get:function(a){return this.templates[a]}};window.Category=Backbone.Model.extend({defaults:{id:null,categoryName:"",consumable:""},urlRoot:"api/category/"});window.CategoryCollection=Backbone.Collection.extend({model:Category,url:"api/category/"});window.Item=Backbone.Model.extend({defaults:{id:null,name:"",quantity:"0",description:"",categoryId:"0",vendorId:"0",emailThreshold:"0",itemUrl:"",},urlRoot:"api/items/",initialize:function(){this.on("error",function(b,a){alert(a)})},adjustQty:function(a){var b=Number(this.get("quantity"));b=b+a;this.set({quantity:b});this.save();if(this.isValid()){app.logCollection.logTransaction("Quantity Adjusted by "+a,this)}},addOrderQty:function(a){var b=Number(this.get("quantity"));b=b+a;this.set({quantity:b});if(this.save()!=false){app.logCollection.logTransaction("Order of "+a+" received",this)}},strValidate:function(b){var a=!/^[^<>:;`~\!\?\\\[\]\{\}]+$/.test(b);return a},urlValidate:function(b){var a=!/^[^<>;`\!\\\[\]\{\}]+$/.test(b);return a},numValidate:function(b){var a=!/^\d+$/.test(b);return a},validate:function(a){if(this.strValidate(a.name)===true){return"Invalid Name"}if(this.numValidate(a.quantity)===true){return"Invalid Quantity"}if(a.categoryId==="0"){return"Please Select a Category"}if(a.vendorId==="0"){return"Please Select a Vendor"}if(this.numValidate(a.emailThreshold)===true){return"Invalid Email Threshold"}if(this.strValidate(a.description)===true){return"Invalid Description"}if(this.urlValidate(a.itemUrl)===true){return"Invalid Url"}},saveItem:function(){if(this.isNew()){var a=this;this.set({name:$("#name").val(),quantity:$("#quantity").val(),description:$("#description").val(),categoryId:$("#categorySelect").val(),vendorId:$("#vendorSelect").val(),emailThreshold:$("#emailThreshold").val(),itemUrl:$("#itemUrl").val()});if(this.isValid()){app.itemCollection.create(this,{success:function(){app.logCollection.logTransaction("New Item Created",a);alert("Item successfully Added");app.navigate("items/"+a.id,true)},error:function(){alert("create error")}})}}else{if(this.save({name:$("#name").val(),quantity:$("#quantity").val(),description:$("#description").val(),categoryId:$("#categorySelect").val(),vendorId:$("#vendorSelect").val(),emailThreshold:$("#emailThreshold").val(),itemUrl:$("#itemUrl").val()})!=false){app.logCollection.logTransaction("Item Saved",this);alert("Item successfully Saved")}}}});window.ItemCollection=Backbone.Collection.extend({model:Item,url:"api/items/",});window.Log=Backbone.Model.extend({defaults:{id:null,action:"",userName:"",itemName:"",logDate:new Date},urlRoot:"api/log/"});window.LogCollection=Backbone.Collection.extend({model:Log,url:"api/log/",logTransaction:function(c,b){var a=new Log();a.set({action:c,userName:user.get("username"),itemName:b.get("name"),logDate:new Date()});a.save();this.add(a)},comparator:function(a){return -Number(new Date(a.get("logDate")).getTime())}});window.Order=Backbone.Model.extend({defaults:{id:null,vendorId:"0",orderDate:new Date,status:"1"},urlRoot:"api/orders/",closeOrder:function(){_.each(this.get("items"),function(a){var b=app.itemCollection.where({id:a.itemId});b[0].addOrderQty(Number(a.orderQty))});this.save({status:"0"})}});window.OrderCollection=Backbone.Collection.extend({model:Order,url:"api/orders/",comparator:function(a){return -Number(new Date(a.get("orderDate")).getTime())}});window.OrderItem=Backbone.Model.extend({defaults:{id:null,itemId:"0",orderQty:"0"}});window.Users=Backbone.Model.extend({defaults:{id:null,username:"",password:"",email:"",roleId:""},urlRoot:"api/users/",strValidate:function(b){var a=!/^[^<>:;`~\!\?\\\[\]\{\}]+$/.test(b);return a},passwordValidate:function(b){var a=!/^[^<>:;`\\\[\]\{\}]+$/.test(b);return a},validate:function(a){if(this.strValidate(a.username)===true){return"Invalid Username"}if(this.passwordValidate(a.password)===true){return"Invalid Password"}},passwordChangeValidateSave:function(){var b=$("#newPassword").val();var a=$("#newPasswordAgain").val();var c=$.md5($("#currentPassword").val());if(c!==this.get("password")){return"Current password is incorrect."}if(b!==a){return"New passwords do not match."}if($.md5(b)===c){return"New password can not be the same as current password."}if(this.passwordValidate(b)===true){return"Invalid characters in new password fields."}else{b=$.md5(b)}this.save({password:b})},saveUser:function(){var a=this;this.set({username:$("#name").val(),password:$.md5($("#password").val()),email:$("#email").val(),});if(this.isValid()){app.userCollection.create(this,{success:function(){app.navigate("users/"+a.id,true)},error:function(){alert("user creation error")}})}}});window.UsersCollection=Backbone.Collection.extend({model:Users,url:"api/users/",});window.User=Backbone.Model.extend({defaults:{id:0,username:"",password:"",roleId:"",access_token:null},urlRoot:"api/login/validate/",initialize:function(){if($.cookie("PHPSESSID")!=null){if(!isNaN($.cookie("PHPSESSID"))){this.id=$.cookie("PHPSESSID");this.set({access_token:$.cookie("PHPSESSID")});this.fetch({type:"POST",})}else{this.id=0}}},authenticated:function(){return Boolean(this.get("access_token")!=null)},unauthenticate:function(){this.unset();this.set({id:0,access_token:null});$.ajax({url:"api/logout/"})},save:function(){},load:function(){self=this;this.fetch({data:{Username:this.get("username"),Password:this.get("password")},type:"POST",success:function(){self.set({access_token:$.cookie("PHPSESSID")});if(self.authenticated()==true){$(".contentBody").empty();$("#header").empty();$("#details").empty();app.navigate("",true)}else{alert("There was a problem logging you in.")}},error:function(){alert("Sorry. Your username and/or password is invalid. Please try again.")}})}});window.Vendor=Backbone.Model.extend({defaults:{id:null,vendorName:"",url:""},urlRoot:"api/vendor/"});window.VendorCollection=Backbone.Collection.extend({model:Vendor,url:"api/vendor/"});window.CategorySelectView=Backbone.View.extend({tagName:"select",initialize:function(){var a=this;$(this.el).attr("id","categorySelect");this.model.bind("reset",this.render,this);$(this.el).html('<option value="0">Select a Category</option>')},render:function(){_.each(this.model.models,function(a){$(this.el).append(new CategoryOptionView({model:a}).render())},this);$(this.el).children("#"+this.options.item.get("categoryId")).attr("selected","selected");return this.el}});window.CategoryOptionView=Backbone.View.extend({tagName:"option",initialize:function(){$(this.el).val(this.model.id);$(this.el).html(this.model.get("categoryName"));this.model.bind("change",this.render,this);$(this.el).attr("id",this.model.id)},render:function(){return this.el}});window.ChangePasswordView=Backbone.View.extend({tagName:"table",initialize:function(){this.template=_.template(tpl.get("changePassword"))},render:function(){var a=$(this.el).html(this.template());$("div#passwordChange").slideUp("fast",function(){$("div#passwordChange").html(a).slideDown()})},events:{"click #submitPassword":"submitPassword","click #cancelPasswordChange":"cancelPasswordChange"},submitPassword:function(){var a=this.options.user.passwordChangeValidateSave();if(a){$("div#passwordStatus").html(a).addClass("errorStatus")}else{$("div#passwordStatus").empty().removeClass("errorStatus");$("div#passwordChange").slideUp(function(){$("div#passwordChange").html('<button id="changePassword" class="changePassword">Change Password</button>').slideDown("fast");$("div#passwordStatus").html("Password Successfully Changed!")})}},cancelPasswordChange:function(){$("div#passwordChange").slideUp(function(){$("div#passwordChange").html('<button id="changePassword" class="changePassword">Change Password</button>').slideDown("fast")})}});window.HeaderView=Backbone.View.extend({initialize:function(){this.template=_.template(tpl.get("header"))},render:function(){$("#header").empty();$(this.el).html(this.template());if(this.options.showManage){$(this.el).children().children("img.manage").hide()}$("#header").html(this.el)},events:{"click .manage":"manage","click .mainImage":"navigateToMain"},manage:function(){var b=$(".manage").offset();var d=$(".manage").outerWidth();var a=$(".manage").outerHeight();var c=$(document).width();$("div#optionsMenu").css({right:(c-(b.left+d))+"px",top:(b.top+(a))+"px"});$("div#optionsMenu").toggle("fast")},navigateToMain:function(){app.navigate("",true)}});window.Item404View=Backbone.View.extend({className:"404Page",initialize:function(){if(this.options.item404){this.template=_.template(tpl.get("item404"))}else{this.template=_.template(tpl.get("site404"))}},render:function(){$(this.el).html(this.template());console.log(this.el);$(".contentBody").empty();$(".contentHeader").empty();$(".contentFooter").empty();$(".contentBody").html(this.el)},events:{"click #home":"navigateToMain",},navigateToMain:function(){app.navigate("",true)}});window.ItemView=Backbone.View.extend({tagName:"div",initialize:function(){this.template=_.template(tpl.get("item-details"))},render:function(){$("#details").empty();$(this.el).html(this.template(this.options.item.toJSON()));if(this.options.item.isNew()){$(this.el).children().children().children().children().children(".delete").hide()}$(this.el).children().children().children().children("#category").append(new CategorySelectView({model:this.options.category,item:this.options.item}).render());$(this.el).children().children().children().children("#vendor").append(new VendorSelectView({model:this.options.vendor,item:this.options.item}).render());$("#details").html(this.el)},events:{"click .save":"saveItem","click .delete":"deleteItem"},saveItem:function(){this.options.item.saveItem()},deleteItem:function(){if(confirm("Are you sure you want to delete this item?")){var a=this.options.item;this.options.item.destroy({success:function(){alert("Item was deleted successfully");app.logCollection.logTransaction("Item Deleted",a);app.navigate("",true)}})}return false}});window.count=1;window.ItemListView=Backbone.View.extend({tagName:"table",className:"itemTable",initialize:function(){this.model.bind("reset",this.render,this);var a=this;this.model.bind("add",function(b){$(a.el).append(new ItemListItemView({model:b,category:a.options.category,vendor:a.options.vendor}).render(count));count++})},render:function(){window.count=0;$(".contentBody").empty();$(this.el).empty();_.each(this.model.models,function(a){$(this.el).append(new ItemListItemView({model:a,category:this.options.category,vendor:this.options.vendor}).render(count));window.count++},this);$(".contentBody").html(this.el)}});window.ItemListItemView=Backbone.View.extend({tagName:"tr",initialize:function(){this.template=_.template(tpl.get("item-list-item"));this.model.bind("change",this.render,this);this.model.bind("destroy",this.close,this);$(this.el).attr("id",this.model.id)},render:function(a){if(window.count%2===0){$(this.el).addClass("even")}$(this.el).html(this.template($.extend({},this.model.toJSON(),this.options.category.get(this.model.get("categoryId")).toJSON(),this.options.vendor.get(this.model.get("vendorId")).toJSON())));return this.el},events:{"click #removeQty":"removeQty","click #addQty":"addQty",click:"showDetails"},removeQty:function(){amount=Number($("tr#"+this.model.id+" input").val());amount-=1;$("tr#"+this.model.id+" input").val(amount)},addQty:function(){amount=Number($("tr#"+this.model.id+" input").val());amount+=1;$("tr#"+this.model.id+" input").val(amount)},showDetails:function(){app.navigate("items/"+this.model.id,true)}});window.ItemListFooterView=Backbone.View.extend({className:"contentFooter",initialize:function(){this.template=_.template(tpl.get("ItemListFooter"))},render:function(){$(".contentFooter").empty();$(this.el).html(this.template);$(".contentFooter").html(this.el)},events:{"click .applyAdjustment":"applyAdjustment",},applyAdjustment:function(){$(".contentBody tr").each(function(){var b=Number($(this).children().children("input").val());if(b!=0){var c=$(this).attr("id");var a=app.itemCollection.get(c);a.adjustQty(b)}});app.navigate("items/adjust",true)}});window.ItemListHeaderView=Backbone.View.extend({className:"contentHeader",initialize:function(){this.template=_.template(tpl.get("ItemListHeader"));this.nameSortFlag=0;this.quantitySortFlag=0},render:function(){$(".contentHeader").empty();$(this.el).html(this.template);$(".contentHeader").html(this.el)},events:{"click td":"sortTable",},sortTable:function(b){var a=$(b.currentTarget).attr("class");switch(a){case"name":if(this.nameSortFlag===0){app.itemCollection.comparator=function(c){return(c.get(a))};app.itemCollection.sort();this.nameSortFlag=1;this.quantitySortFlag=0;$("thead img.quantityImg").attr("hidden","hidden");$("thead img.nameImg").removeAttr("hidden");$("thead img.nameImg").attr("src","images/DecendingTiny.jpg")}else{app.itemCollection.comparator=function(c){return String.fromCharCode.apply(String,_.map(c.get(a).split(""),function(d){return 65535-d.charCodeAt()}))};app.itemCollection.sort();this.nameSortFlag=0;$("thead img.nameImg").attr("src","images/AcendingTiny.jpg")}break;case"quantity":if(this.quantitySortFlag===0){app.itemCollection.comparator=function(c){return Number(c.get(a).valueOf())};app.itemCollection.sort();this.quantitySortFlag=1;this.nameSortFlag=0;$("thead img.nameImg").attr("hidden","hidden");$("thead img.quantityImg").removeAttr("hidden");$("thead img.quantityImg").attr("src","images/DecendingTiny.jpg")}else{app.itemCollection.comparator=function(c){return -Number(c.get(a).valueOf())};app.itemCollection.sort();this.quantitySortFlag=0;$("thead img.quantityImg").attr("src","images/AcendingTiny.jpg")}break}}});window.LoginView=Backbone.View.extend({tagName:"div",initialize:function(){this.template=_.template(tpl.get("login"))},render:function(){$(".contentHeader").empty();$(".contentBody").empty();$(".contentFooter").empty();$(this.el).html(this.template());$(".contentBody").html(this.el)},events:{"click .login":"userLogin",},userLogin:function(b){var c=$("input#username").val();var a=$.md5($("input#password").val());this.model.set({username:c,password:a});this.model.load();b.preventDefault()}});window.LogListView=Backbone.View.extend({tagName:"table",className:"logTable",initialize:function(){this.model.bind("reset",this.render,this);this.count=1},render:function(){$(".contentBody").empty();$(this.el).empty();this.count=0;_.each(this.model.models,function(a){$(this.el).append(new LogListItemView({model:a}).render(this.count));this.count++},this);$(".contentBody").html(this.el)}});window.LogListItemView=Backbone.View.extend({tagName:"tr",initialize:function(){this.template=_.template(tpl.get("log-list-item"));this.model.bind("change",this.render,this);$(this.el).attr("id",this.model.id)},render:function(a){if(a%2===0){$(this.el).addClass("even")}$(this.el).html(this.template(this.model.toJSON()));return this.el}});window.LogListFooterView=Backbone.View.extend({className:"contentFooter",initialize:function(){this.template=_.template(tpl.get("LogListFooter"))},render:function(){$(".contentFooter").empty();$(this.el).html(this.template);$(".contentFooter").html(this.el)},events:{"click #returnToInventory":"returnToInventory"},returnToInventory:function(){app.navigate("",true);return true}});window.LogListHeaderView=Backbone.View.extend({className:"contentHeader",initialize:function(){this.template=_.template(tpl.get("LogListHeader"));this.actionSortFlag=0;this.usernameSortFlag=0},render:function(){$(".contentHeader").empty();$(this.el).html(this.template);$(".contentHeader").html(this.el)},events:{"click td":"sortTable",},sortTable:function(b){var a=$(b.currentTarget).attr("class");switch(a){case"action":if(this.actionSortFlag===0){app.logCollection.comparator=function(c){return(c.get(a))};app.logCollection.sort();this.actionSortFlag=1;this.usernameSortFlag=0;$("thead img.usernameImg").attr("hidden","hidden");$("thead img.actionImg").removeAttr("hidden");$("thead img.actionImg").attr("src","images/DecendingTiny.jpg")}else{app.logCollection.comparator=function(c){return String.fromCharCode.apply(String,_.map(c.get(a).split(""),function(d){return 65535-d.charCodeAt()}))};app.logCollection.sort();this.actionSortFlag=0;$("thead img.actionImg").attr("src","images/AcendingTiny.jpg")}break;case"userName":if(this.usernameSortFlag===0){app.logCollection.comparator=function(c){return(c.get(a))};app.logCollection.sort();this.usernameSortFlag=1;this.actionSortFlag=0;$("thead img.actionImg").attr("hidden","hidden");$("thead img.userNameImg").removeAttr("hidden");$("thead img.userNameImg").attr("src","images/DecendingTiny.jpg")}else{app.logCollection.comparator=function(c){return String.fromCharCode.apply(String,_.map(c.get(a).split(""),function(d){return 65535-d.charCodeAt()}))};app.logCollection.sort();this.usernameSortFlag=0;$("thead img.usernameImg").attr("src","images/AcendingTiny.jpg")}break}}});window.OptionsMenuView=Backbone.View.extend({tagName:"table",className:"optionsTable",initialize:function(){this.template=_.template(tpl.get("optionsMenu"));this.render();$("div#optionsMenu").hide();$("div#optionsMenu").removeAttr("hidden")},render:function(){this.$el.html(this.template());$("#optionsMenu").html(this.el)},events:{"click tr#logout":"logout","click tr#addItem":"newItem","click tr#viewLog":"viewLog","click tr#manageUsers":"manageUsers","click tr#newUser":"newUser","click tr#placeOrder":"placeOrder","click tr#viewOrder":"viewOrder",mouseleave:"leave"},logout:function(){user.unauthenticate();$("div#optionsMenu").hide("fast");app.navigate("login",true)},newItem:function(){app.navigate("items/new",true);return false},viewLog:function(){app.navigate("log/view",true);return true},manageUsers:function(){app.navigate("users",true);return true},newUser:function(){app.navigate("users/new",true);return true},placeOrder:function(){app.navigate("items/placeOrder",true);return true},viewOrder:function(){app.navigate("items/viewOrder",true);return true},leave:function(){$("div#optionsMenu").hide("fast")}});window.OrderView=Backbone.View.extend({tagName:"div",initialize:function(){this.options.order.bind("change",this.render,this);this.template=_.template(tpl.get("order-details"))},render:function(){$("#details").empty();var a=new Object();if(this.options.order.get("status")==="1"){a.openStatus="Yes"}else{a.openStatus="No"}$(this.el).html(this.template($.extend({},a,this.options.order.toJSON(),this.options.vendor.get(this.options.order.get("vendorId")).toJSON())));$(this.el).children().children().children().children().children("#items").html(new OrderItemsView({model:this.options.order,items:app.itemCollection}).render());if(this.options.order.get("status")==="0"){$(this.el).children().children().children().children().children(".close").hide()}$("#details").html(this.el)},events:{"click .close":"closeOrder",},closeOrder:function(){if(confirm("Are you sure you want to close this order out?")){this.options.order.closeOrder()}}});window.OrderItemsView=Backbone.View.extend({tagName:"table",className:"orderItems",initialize:function(){this.template=_.template('<tr><td><%= name %></td><td class="rightJustify"><%= orderQty %></td></tr>')},render:function(){$(this.el).append('<tr><td>Item Name</td><td class="rightJustify">Quantity</td></tr>');_.each(this.model.get("items"),function(a){$(this.el).append(this.template($.extend({},a,this.options.items.get(a.itemId).toJSON())))},this);return this.el}});window.count=1;window.OrderFormView=Backbone.View.extend({tagName:"table",className:"orderTable",initialize:function(){var a=this;this.model.bind("reset",this.render,this);this.model.bind("add",function(b){$(a.el).append(new OrderFormItemView({model:b,category:a.options.category,vendor:a.options.vendor}).render(count));count++})},render:function(){window.count=0;$(".contentBody").empty();$(this.el).empty();_.each(this.model.models,function(a){$(this.el).append(new OrderFormItemView({model:a,category:this.options.category,vendor:this.options.vendor}).render(count));count++},this);$(".contentBody").html(this.el)}});window.OrderFormItemView=Backbone.View.extend({tagName:"tr",initialize:function(){this.template=_.template(tpl.get("order-form-item"));this.model.bind("change",this.render,this);this.model.bind("destroy",this.close,this);$(this.el).attr("id",this.model.id)},render:function(a){if(a%2===0){$(this.el).addClass("even")}$(this.el).html(this.template($.extend({},this.model.toJSON(),this.options.category.get(this.model.get("categoryId")).toJSON(),this.options.vendor.get(this.model.get("vendorId")).toJSON())));return this.el}});window.OrderFormFooterView=Backbone.View.extend({className:"contentFooter",initialize:function(){this.template=_.template(tpl.get("OrderFormFooter"))},render:function(){$(this.el).html(this.template);$(".contentFooter").html(this.el)},events:{"click .submitOrder":"sumbitOrder",},sumbitOrder:function(){var b=[];var a=new OrderCollection();$(".contentBody tr").each(function(){var h=Number($(this).children().children("input").val());if(h>0){var j=$(this).attr("id");var e=app.itemCollection.get(j);var c=e.get("vendorId");var d=new OrderItem({itemId:j,orderQty:h});if($.inArray(c,b)!=-1){var i=a.where({vendorId:c});i[0].get("items").push(d)}else{b.push(c);var g=[];var f=new Order({vendorId:c,items:g});f.get("items").push(d);a.add(f)}}});_.each(a.models,function(c){app.orderCollection.create(c,{success:function(){_.each(c.get("items"),function(d){app.logCollection.logTransaction("Order of "+d.orderQty+" added",app.itemCollection.where({id:d.itemId})[0])});app.navigate("items/viewOrder",true)},error:function(){console.log("there was an error")}})})}});window.OrderFormHeaderView=Backbone.View.extend({className:"contentHeader",initialize:function(){this.template=_.template(tpl.get("orderFormHeader"));this.nameSortFlag=0;this.quantitySortFlag=0},render:function(){$(this.el).html(this.template);$(".contentHeader").html(this.el)},events:{"click td":"sortTable",},sortTable:function(b){var a=$(b.currentTarget).attr("class");switch($(b.currentTarget).attr("class")){case"name":if(this.nameSortFlag===0){app.itemCollection.comparator=function(c){return(c.get(a))};app.itemCollection.sort();this.nameSortFlag=1;this.quantitySortFlag=0;$("thead img.quantityImg").attr("hidden","hidden");$("thead img.nameImg").removeAttr("hidden");$("thead img.nameImg").attr("src","images/DecendingTiny2.jpg")}else{app.itemCollection.comparator=function(c){return String.fromCharCode.apply(String,_.map(c.get(a).split(""),function(d){return 65535-d.charCodeAt()}))};app.itemCollection.sort();this.nameSortFlag=0;$("thead img.nameImg").attr("src","images/AcendingTiny2.jpg")}break;case"quantity":if(this.quantitySortFlag===0){app.itemCollection.comparator=function(c){return Number(c.get(a).valueOf())};app.itemCollection.sort();this.quantitySortFlag=1;this.nameSortFlag=0;$("thead img.nameImg").attr("hidden","hidden");$("thead img.quantityImg").removeAttr("hidden");$("thead img.quantityImg").attr("src","images/DecendingTiny2.jpg")}else{app.itemCollection.comparator=function(c){return -Number(c.get(a).valueOf())};app.itemCollection.sort();this.quantitySortFlag=0;$("thead img.quantityImg").attr("src","images/AcendingTiny2.jpg")}break}}});window.count=1;window.OrderListView=Backbone.View.extend({tagName:"table",className:"orderTable",initialize:function(){this.model.bind("change",this.render,this);var a=this;this.model.bind("reset",this.render,this);this.model.bind("add",function(b){$(a.el).append(new OrderListItemView({model:b,vendor:a.options.vendor}).render(count));count++})},render:function(){window.count=0;$(".contentBody").empty();$(this.el).empty();_.each(this.model.models,function(a){$(this.el).append(new OrderListItemView({model:a,vendor:this.options.vendor}).render(count));count++},this);$(".contentBody").html(this.el)}});window.OrderListItemView=Backbone.View.extend({tagName:"tr",initialize:function(){this.template=_.template(tpl.get("orderListItem"));this.model.bind("change",this.render,this);this.model.bind("destroy",this.close,this);$(this.el).attr("id",this.model.id)},render:function(a){if(a%2===0){$(this.el).addClass("even")}var b=new Object();b.itemCount=this.model.get("items").length;if(this.model.get("status")==="1"){b.open="Yes"}else{b.open="No"}$(this.el).html(this.template($.extend({},this.model.toJSON(),this.options.vendor.get(this.model.get("vendorId")).toJSON(),b)));return this.el},events:{click:"showDetails"},showDetails:function(){app.navigate("items/viewOrder/"+this.model.id,true)}});window.OrderListFooterView=Backbone.View.extend({className:"contentFooter",initialize:function(){this.template=_.template(tpl.get("OrderListFooter"))},render:function(){$(this.el).html(this.template);$(".contentFooter").html(this.el)},events:{"click .returnToInventory":"returnToInv",},returnToInv:function(){app.navigate("",true)}});window.OrderListHeaderView=Backbone.View.extend({className:"contentHeader",initialize:function(){this.template=_.template(tpl.get("orderListHeader"));this.nameSortFlag=0;this.quantitySortFlag=0},render:function(){$(this.el).html(this.template);$(".contentHeader").html(this.el)},});window.StartView=Backbone.View.extend({initialize:function(){this.template=_.template(tpl.get("start"))},render:function(){$("#details").empty();this.$el.html(this.template());$("#details").html(this.el)}});window.UserView=Backbone.View.extend({tagName:"div",initialize:function(){if(this.options.user.isNew()){this.template=_.template(tpl.get("newUser-details"))}else{if(this.options.user.get("username")!==window.user.get("username")){this.template=_.template(tpl.get("user-details"))}else{this.template=_.template(tpl.get("current-user-details"))}}},render:function(){$("#details").empty();$(this.el).html(this.template(this.options.user.toJSON()));$("#details").html(this.el);if(this.options.user.isNew()){console.log("new")}},events:{"click .save":"saveUser","click .delete":"deleteUser","click .changePassword":"changePassword"},saveUser:function(){this.options.user.saveUser()},deleteUser:function(){if(confirm("Are you sure you want to delete this user?")){var a=this.options.user;this.options.user.destroy({success:function(){alert("User was deleted successfully");app.navigate("users",true)}})}return false},changePassword:function(){this.changePasswordView=new ChangePasswordView({user:this.options.user}).render()}});window.count=1;window.UserListView=Backbone.View.extend({tagName:"table",className:"userTable",initialize:function(){this.model.bind("change",this.render,this);this.model.bind("reset",this.render,this);var a=this;this.model.bind("add",function(b){$(a.el).append(new UserListUserView({model:b}).render(count));count++})},render:function(){window.count=0;$(".contentBody").empty();$(this.el).empty();_.each(this.model.models,function(a){$(this.el).append(new UserListUserView({model:a}).render(count));window.count++},this);$(".contentBody").html(this.el)}});window.UserListUserView=Backbone.View.extend({tagName:"tr",initialize:function(){this.template=_.template(tpl.get("user-list-user"));this.model.bind("change",this.render,this);this.model.bind("destroy",this.close,this);$(this.el).attr("id",this.model.id)},render:function(a){if(window.count%2===0){$(this.el).addClass("even")}$(this.el).html(this.template(this.model.toJSON()));return this.el},events:{click:"showDetails"},showDetails:function(){app.navigate("users/"+this.model.id,true)}});window.UserListFooterView=Backbone.View.extend({className:"contentFooter",initialize:function(){this.template=_.template(tpl.get("userListFooter"))},render:function(){$(".contentFooter").empty();$(this.el).html(this.template);$(".contentFooter").html(this.el)},events:{"click #returnToInventory":"returnToInventory"},returnToInventory:function(){app.navigate("",true);return true}});window.UserListHeaderView=Backbone.View.extend({className:"contentHeader",initialize:function(){this.template=_.template(tpl.get("userListHeader"));this.nameSortFlag=0;this.quantitySortFlag=0},render:function(){$(".contentHeader").empty();$(this.el).html(this.template);$(".contentHeader").html(this.el)},events:{"click td":"sortTable",},sortTable:function(b){var a=$(b.currentTarget).attr("class");switch(a){case"name":if(this.nameSortFlag===0){app.userCollection.comparator=function(c){return(c.get(a))};app.userCollection.sort();this.nameSortFlag=1;this.quantitySortFlag=0;$("thead img.quantityImg").attr("hidden","hidden");$("thead img.nameImg").removeAttr("hidden");$("thead img.nameImg").attr("src","images/DecendingTiny.jpg")}else{app.userCollection.comparator=function(c){return String.fromCharCode.apply(String,_.map(c.get(a).split(""),function(d){return 65535-d.charCodeAt()}))};app.userCollection.sort();this.nameSortFlag=0;$("thead img.nameImg").attr("src","images/AcendingTiny.jpg")}break;case"quantity":if(this.quantitySortFlag===0){app.userCollection.comparator=function(c){return Number(c.get(a).valueOf())};app.userCollection.sort();this.quantitySortFlag=1;this.nameSortFlag=0;$("thead img.nameImg").attr("hidden","hidden");$("thead img.quantityImg").removeAttr("hidden");$("thead img.quantityImg").attr("src","images/DecendingTiny.jpg")}else{app.userCollection.comparator=function(c){return -Number(c.get(a).valueOf())};app.userCollection.sort();this.quantitySortFlag=0;$("thead img.quantityImg").attr("src","images/AcendingTiny.jpg")}break}}});window.VendorSelectView=Backbone.View.extend({tagName:"select",initialize:function(){var a=this;$(this.el).attr("id","vendorSelect");this.model.bind("reset",this.render,this);$(this.el).html('<option value="0">Select a Vendor</option>')},render:function(){_.each(this.model.models,function(a){$(this.el).append(new VendorOptionView({model:a}).render())},this);$(this.el).children("#"+this.options.item.get("vendorId")).attr("selected","selected");return this.el}});window.VendorOptionView=Backbone.View.extend({tagName:"option",initialize:function(){$(this.el).val(this.model.id);$(this.el).html(this.model.get("vendorName"));this.model.bind("change",this.render,this);$(this.el).attr("id",this.model.id)},render:function(){return this.el}});Backbone.View.prototype.close=function(){if(this.beforeClose){this.beforeClose()}this.remove();this.unbind()};var AppRouter=Backbone.Router.extend({initialize:function(){new OptionsMenuView()},routes:{"":"list","items/new":"newItem","items/adjust":"redirectAdjust","items/placeOrder":"placeOrder","items/viewOrder":"viewOrder","log/view":"logView",users:"users","users/new":"newUser","users/:id":"userDetails","items/viewOrder/:id":"orderDetails","items/:id":"itemDetails",login:"login",":unknown":"unknown"},list:function(){this.userAuthentication(function(){this.startView=new StartView().render();this.showItemTable()})},itemDetails:function(a){this.userAuthentication(function(){var c=this.itemCollection.get(a);var b=this.categoryCollection;var d=this.vendorCollection;if(c){this.itemView=new ItemView({item:c,category:b,vendor:d}).render();if(!app.itemListView){this.showItemTable()}}else{this.view404=new Item404View({item404:"yes"}).render();this.startView=new StartView().render();this.headerView=new HeaderView().render()}})},newItem:function(){this.userAuthentication(function(){var a=this.categoryCollection;var b=this.vendorCollection;this.itemView=new ItemView({item:new Item(),category:a,vendor:b}).render();this.showItemTable()})},redirectAdjust:function(){this.userAuthentication(function(){this.startView=new StartView().render();this.showItemTable()})},login:function(){this.userAuthentication();this.headerView=new HeaderView({showManage:"no"}).render();this.startView=new StartView().render();this.loginView=new LoginView({model:user}).render()},placeOrder:function(){this.userAuthentication(function(){this.headerView=new HeaderView({}).render();this.startView=new StartView().render();this.orderFormHeaderView=new OrderFormHeaderView().render();this.orderFormView=new OrderFormView({model:app.itemCollection,category:app.categoryCollection,vendor:app.vendorCollection}).render();this.orderFormFooterView=new OrderFormFooterView().render()})},viewOrder:function(){this.userAuthentication(function(){this.headerView=new HeaderView({}).render();this.startView=new StartView().render();this.orderListHeaderView=new OrderListHeaderView().render();this.orderListView=new OrderListView({model:app.orderCollection,vendor:app.vendorCollection}).render();this.orderListFooterView=new OrderListFooterView().render()})},orderDetails:function(a){this.userAuthentication(function(){var b=this.orderCollection.get(a);var c=this.vendorCollection;if(b){this.orderView=new OrderView({order:b,vendor:c}).render();if(!app.orderListView){this.showOrderTable()}}else{this.view404=new Item404View({item404:"yes"}).render();this.startView=new StartView().render();this.headerView=new HeaderView().render()}})},logView:function(){this.userAuthentication(function(){this.startView=new StartView().render();this.showLogTable()})},showItemTable:function(){this.headerView=new HeaderView({}).render();this.itemListHeaderView=new ItemListHeaderView({}).render();this.itemListView=new ItemListView({model:app.itemCollection,category:app.categoryCollection,vendor:app.vendorCollection});this.itemListView.render();this.itemListFooterView=new ItemListFooterView({}).render()},showLogTable:function(){this.headerView=new HeaderView({}).render();this.loglistHeaderView=new LogListHeaderView({}).render();this.loglistView=new LogListView({model:app.logCollection}).render();this.loglistFooterView=new LogListFooterView({}).render()},showOrderTable:function(){this.headerView=new HeaderView({}).render();this.orderListHeaderView=new OrderListHeaderView().render();this.orderListView=new OrderListView({model:app.orderCollection,vendor:app.vendorCollection}).render();this.orderListFooterView=new OrderListFooterView().render()},users:function(){this.userAuthentication(function(){this.startView=new StartView().render();this.showUserTable()})},newUser:function(){this.userAuthentication(function(){this.userView=new UserView({user:new Users(),}).render();this.showUserTable()})},userDetails:function(a){this.userAuthentication(function(){var b=this.userCollection.get(a);if(b){this.userView=new UserView({user:b,}).render();if(!app.userListView){this.showUserTable()}}else{this.view404=new Item404View({item404:"yes"}).render();this.startView=new StartView().render();this.headerView=new HeaderView().render()}})},showUserTable:function(){this.headerView=new HeaderView({}).render();this.userListHeaderView=new UserListHeaderView({}).render();this.userListView=new UserListView({model:app.userCollection}).render();this.userListFooterView=new UserListFooterView({}).render()},userAuthentication:function(a){if(!window.user){window.user=new User()}if(user.authenticated()){this.getData(a)}else{app.navigate("login",true)}},unknown:function(){this.userAuthentication(function(){this.item404View=new Item404View().render();this.startView=new StartView().render();this.headerView=new HeaderView().render()})},getData:function(b){if(this.vendorCollection){if(b){b.call(this)}}else{this.itemCollection=new ItemCollection();this.categoryCollection=new CategoryCollection();this.vendorCollection=new VendorCollection();this.logCollection=new LogCollection();this.userCollection=new UsersCollection();this.orderCollection=new OrderCollection();var a=this;this.itemCollection.fetch({success:function(){a.categoryCollection.fetch({success:function(){a.vendorCollection.fetch({success:function(){a.logCollection.fetch({success:function(){a.userCollection.fetch({success:function(){a.orderCollection.fetch({success:function(){if(b){b.call(a)}}})}})}})}})}})}})}}});tpl.loadTemplates(["orderFormHeader","order-form-item","OrderFormFooter","changePassword","header","item-details","item-list-item","start","login","ItemListHeader","ItemListFooter","log-list-item","LogListHeader","LogListFooter","optionsMenu","item404","site404","user-details","userListFooter","userListHeader","user-list-user","newUser-details","current-user-details","OrderListFooter","orderListHeader","orderListItem","order-details"],function(){window.app=new AppRouter();Backbone.history.start()});